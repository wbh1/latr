# Default values for latr.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: ghcr.io/wbh1/latr
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Automatically mount a ServiceAccount's API credentials?
  automount: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}
podLabels: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65534
  runAsGroup: 65534
  fsGroup: 65534
  seccompProfile:
    type: RuntimeDefault

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: true

resources:
  limits:
    cpu: 500m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Additional volumes on the output Deployment definition.
volumes: []
# - name: foo
#   secret:
#     secretName: mysecret
#     optional: false

# Additional volumeMounts on the output Deployment definition.
volumeMounts: []
# - name: foo
#   mountPath: "/etc/foo"
#   readOnly: true

nodeSelector: {}

tolerations: []

affinity: {}

# Pod Disruption Budget
podDisruptionBudget:
  enabled: false
  minAvailable: 1
  # maxUnavailable: 1

# latr application configuration
config:
  # Daemon settings
  daemon:
    # Mode: "daemon" for continuous operation or "one-shot" for single execution
    mode: daemon
    # Check interval for daemon mode (e.g., "30m", "1h", "6h")
    checkInterval: "30m"
    # Dry run mode - test without making actual changes
    dryRun: false

  # Rotation settings
  rotation:
    # Rotate when this percentage of validity remains (e.g., 10 = rotate at 10% remaining)
    thresholdPercent: 10
    # Whether to prune (delete) expired tokens from Linode
    pruneExpired: false

  # Vault configuration
  vault:
    # Vault server address (e.g., "https://vault.example.com:8200")
    address: ""
    # Vault mount path for KV v2 secrets engine
    mountPath: "secret"
    # AppRole authentication credentials
    # These reference Kubernetes secrets by default
    roleId: ""
    secretId: ""

  # Observability settings
  observability:
    # OpenTelemetry collector endpoint (optional, e.g., "otel-collector:4317")
    otelEndpoint: ""
    # Log level: debug, info, warn, error
    logLevel: "info"

  # Token definitions
  # At least one token must be defined
  tokens: []
  # Example token configuration:
  # - label: my-api-token
  #   team: platform-team
  #   validity: 90d
  #   scopes: "*"
  #   rotationThreshold: 10
  #   storage:
  #     - type: vault
  #       path: secret/data/linode/tokens/my-api-token

# Secrets configuration
# These values should be provided via a separate values file or via --set flags
secrets:
  # Linode API token (required)
  linodeToken: ""

  # Vault AppRole credentials
  # If not using existingSecret, these values will be used
  vaultRoleId: ""
  vaultSecretId: ""

  # Use an existing secret instead of creating a new one
  # The secret should contain keys: linode-token, vault-role-id, vault-secret-id
  existingSecret: ""

# Environment variables
# Additional environment variables to set
env: []
# - name: LINODE_API_URL
#   value: "https://api.linode.com"

# Environment variables from secrets/configmaps
envFrom: []
# - secretRef:
#     name: my-secret
# - configMapRef:
#     name: my-configmap
